@model notomyk.ViewModel.NewsDetail
@using notomyk.Infrastructure
@using notomyk.Models

@{
    var imgUrl = Url.Content(AppConfig.UserLogoLink(User.Identity.GetUserId()));
}

@Html.Partial("_NewsDetailTemplates")

<div id="SingleNews" class="first">
    <div class="col-xs-12 removePadding list-group-item n1">
            <div class="col-xs-12 removePadding">
                <div class="col-sm-6 col-xs-12" style="padding: 0 7px 0 10px">
                    <div class="fof col-xs-12 removePadding">
                        <div class="ui labeled button fakt pull-left" tabindex="0" data-content="@ViewBag.popupMsg" data-position="top center">
                            @if (@Model.WhatVote == 1)
                            {
                                <div class="voteFakt ui green BGgreenColor button">
                                    <i class="thumbs outline up icon"></i> Fakt
                                </div>
                            }
                            else
                            {
                                <div class="voteFakt ui green BGgreenColor button BGgreenColorLight">
                                    <i class="thumbs outline up icon"></i> Fakt
                                </div>
                            }

                            <a class="voteFakt ui basic green left pointing label">
                                @Model.SingleNews.VoteLogs.Where(x => x.Vote == true).Count()
                            </a>
                        </div>
                        <div class="ui labeled button fake pull-right " tabindex="0" data-content="@ViewBag.popupMsg" data-position="top center">
                            <a class="voteFake ui basic red right pointing label">
                                @Model.SingleNews.VoteLogs.Where(x => x.Vote == false).Count()
                            </a>

                            @if (@Model.WhatVote == -1)
                            {
                                <div class="voteFake ui red BGredColor button">
                                    <i class="thumbs outline down icon"></i> Fake
                                </div>
                            }
                            else
                            {
                                <div class="voteFake ui red BGredColor button BGredColorLight">
                                    <i class="thumbs outline down icon"></i> Fake
                                </div>
                            }

                        </div>
                    </div>
                    <div class="col-xs-12" style="padding: 0 3px 0 0">
                        <div class="ui cards">
                            <div class="card">

                                <div class="statInfo content">
                                    <img class="newspaperLogo left floated ui image visible-xs" src="@Url.NewspaperIconPath_250(Model.SingleNews.Newspaper.NewspaperIconLink)" height="57" style="margin-right:10px">
                                    <img class="userLogoNews right floated ui image img-circle" src="@Url.Content(AppConfig.UserLogoLink(Model.SingleNews.ApplicationUser.Id))" height="45" width="45" style="margin-top:5px">
                                    <div class="header">

                                    </div>
                                    <div class="meta">
                                        <i class="newspaper restore icon"></i><small>News z: <strong><a href="http://@Model.SingleNews.Newspaper.NewspaperLink">@Model.SingleNews.Newspaper.NewspaperLink</a></strong></small>
                                    </div>
                                    <div class="meta">
                                        <i class="user restore icon"></i><small>Dodał: <strong>@Model.SingleNews.ApplicationUser.UserName</strong></small>
                                    </div>
                                    <div class="meta">
                                        <i class="calendar restore icon"></i><small>Kiedy: <strong>@GetTimeAgo.CalculateDateDiff(Model.SingleNews.DateAdd)</strong></small>
                                    </div>
                                </div>

                                <div class="statButtons extra content">
                                    <div class="ui three buttons">
                                        <div class="ui compact menu col-xs-4" style="padding: 0 5px 0 5px">
                                            <x class="item">
                                                <i class="icon mail"></i> Komentarzy
                                                <div class="floating ui basic blue label">@ViewBag.CommNum</div>

                                        </div>
                                        <div class="ui compact menu col-xs-4" style="padding: 0 5px 0 5px; border-left:none; border-right:none;">
                                            <x class="item">
                                                <i class="icon tv"></i> Odwiedzin
                                                <div class="floating ui basic grey label">@Model.SingleNews.Visitors</div>
                                            </x>
                                        </div>
                                        <div class="fb-share-button col-xs-4"
                                             style="background-color:#4267b2; padding-top:1px"
                                             data-href="@ViewBag.fbButtonUrl"
                                             data-layout="button_count"
                                             data-size="large"
                                             data-mobile-iframe="true">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="col-sm-6 col-xs-12" style="padding:0 10px 0 10px">
                    <img class="img-responsive img-rounded" alt="" src="@Model.SingleNews.PictureLink" />
                </div>
            </div>
            <div class="col-xs-12 removePadding" style="padding: 10px;">
                <div class="col-xs-11 removePadding">
                    <a href="@Model.SingleNews.ArticleLink"><strong><span class="text" style="color: #2375B9">@Model.SingleNews.Title</span></strong></a>
                </div>
                <div class="col-xs-1 removePadding" style="text-align:right">
                    <div class="ui dropdown">
                        <i class="dropdown-togle large sidebar icon" data-toggle="dropdown"></i>
                        <div class="menu left dropDownParent" data-newsid="@Model.SingleNews.tbl_NewsID">
                            <div class="reportNews item">Zgłoś</div>

                            @if (User.IsInRole("Admin") || User.IsInRole("Moderator"))
                            {
                                <div class="deleteNews item">Usuń</div>
                            }

                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xs-12" style="padding:0 10px 0 10px"><span class="text">@Model.SingleNews.Description</span></div>

            <div class="col-xs-12 removePadding" style="padding:0 10px 0 5px;">
                <div class="col-xs-11 removePadding">
                    <input id="commaDelimitedTags" type="text" value="@Model.CommaSeparatedTags" data-role="tagsinput">
                </div>

                <div class="col-xs-1" style="text-align:right; padding: 10px 0 0 0">
                    @if (Request.IsAuthenticated)
                    {
                        if (User.IsInRole("Admin") || User.IsInRole("Moderator") || myUser.IsNewsAuthor(Model.SingleNews.tbl_NewsID, User.Identity.GetUserId()))
                        {
                            <i id="editTags" class="dropdown-togle large tags icon" data-toggle="dropdown" style="cursor:pointer"></i>
                        }
                    }
                </div>
            </div>

            <div id="addComment" class="col-xs-12">
                @if (Request.IsAuthenticated)
                {
                    <div class="col-xs-2 col-sm-1" style="padding:14px 0 0 0">
                        <img src="@imgUrl" class="img-circle avatar imgUserLogoSmall pull-left" alt="img">
                    </div>
                    <div class="col-xs-9 col-sm-10 removePadding">
                        <span class="charCounter pull-right" style="font-size:11px"></span>
                        <textarea maxlength="3000" id="frmCommentText" rows="10" name="CommentText" class="form-control message" style="height: 34px; overflow: hidden;" placeholder="Co uważasz o tym artykule ?"></textarea>
                    </div>
                    <div class="col-xs-1" style="padding:14px 0 0 0">
                        <form class="frmAddComment  pull-right">
                            <input class="frmNewsID" type="hidden" name="NewsID" value=@Model.SingleNews.tbl_NewsID>
                            <button class="btn btn-primary" type="submit">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </button>
                        </form>
                    </div>
                }
                else
                {
                    <div class="col-xs-12 removePadding">
                        <textarea id="frmCommentTextNoAuth" readonly rows="10" cols="500" name="CommentText" class="form-control message" style="height: 34px; overflow: hidden; resize:none" placeholder="Zaloguj się aby dodać komentarz."></textarea>
                    </div>
                    <input class="frmNewsID" type="hidden" name="NewsID" value=@Model.SingleNews.tbl_NewsID>
                }
            </div>
    </div>  
</div>

@Html.Partial("_GenericComment")